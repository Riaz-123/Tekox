<!DOCTYPE html>
<html>
<head>
<title>Download Marksheet</title>
<style>
body {
  font-family: Arial;
  background: #f0f4f8;
  text-align: center;
  padding: 50px;
}
.card {
  width: 500px;
  margin: auto;
  background: #fff;
  padding: 20px;
  box-shadow: 0 0 10px rgba(0,0,0,0.2);
  border-radius: 10px;
}
input {
  padding: 10px;
  width: 70%;
  margin-bottom: 10px;
}
button {
  padding: 10px 20px;
  background: #007bff;
  color: #fff;
  border: none;
  border-radius: 5px;
}
</style>
</head>
<body>
<div class="card">
  <h2>Download Your Marksheet</h2>
  <input type="text" id="roll" placeholder="Enter Roll Number">
  <br>
  <button onclick="getMarksheet()">Get Marksheet</button>
  <div id="result" style="margin-top:20px;"></div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script>
const { jsPDF } = window.jspdf;

async function getMarksheet() {
  const roll = document.getElementById('roll').value.trim();
  if (!roll) {
    alert('Please enter roll number!');
    return;
  }

  const response = await fetch(`https://script.google.com/macros/s/YOUR_WEB_APP_URL/exec?roll=${roll}`);
  const data = await response.json();
  
  if (data.error) {
    document.getElementById('result').innerHTML = "<p style='color:red;'>Roll Number not found</p>";
  } else {
    document.getElementById('result').innerHTML = `
      <h3>${data.name}</h3>
      <p>Total: ${data.total} | Grade: ${data.grade}</p>
      <button onclick='generatePDF(${JSON.stringify(data)})'>Download PDF</button>
    `;
  }
}

function generatePDF(data) {
  const doc = new jsPDF({
    orientation: 'portrait',
    unit: 'pt',
    format: 'a4'
  });

  // Add custom marksheet layout
  doc.setFont('helvetica', 'bold');
  doc.setFontSize(20);
  doc.text("Mazhar Model Elementary School", 210, 50, { align: 'center' });

  doc.setFontSize(14);
  doc.setFont('helvetica', 'normal');
  doc.text("Annual Examination - 2025", 210, 70, { align: 'center' });

  doc.line(40, 90, 550, 90); // header underline

  // Student Info
  doc.setFontSize(12);
  doc.text(`Roll No: ${data.roll}`, 60, 120);
  doc.text(`Name: ${data.name}`, 60, 140);

  // Table Header
  doc.setFont('helvetica', 'bold');
  doc.text("Subject", 60, 180);
  doc.text("Marks", 300, 180);
  doc.line(40, 190, 550, 190);

  // Subjects & Marks
  doc.setFont('helvetica', 'normal');
  let y = 210;
  doc.text("English", 60, y); doc.text(`${data.english}`, 300, y); y += 20;
  doc.text("Math", 60, y); doc.text(`${data.math}`, 300, y); y += 20;
  doc.text("Science", 60, y); doc.text(`${data.science}`, 300, y); y += 20;

  doc.line(40, y + 10, 550, y + 10);

  // Total & Grade
  y += 30;
  doc.text(`Total: ${data.total}`, 60, y);
  doc.text(`Grade: ${data.grade}`, 300, y);

  y += 40;
  const percentage = ((data.total / 300) * 100).toFixed(2);
  doc.text(`Percentage: ${percentage}%`, 60, y);

  // Footer
  y += 50;
  doc.setFontSize(10);
  doc.text("This is a system-generated marksheet.", 210, y, { align: 'center' });

  doc.save(`Marksheet_${data.roll}.pdf`);
}
</script>
</body>
</html>
