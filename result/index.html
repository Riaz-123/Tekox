<!DOCTYPE html>
<html>
<head>
<title>Download Marksheet</title>
<style>
body {
  font-family: Arial;
  background: #f0f4f8;
  text-align: center;
  padding: 50px;
}
.card {
  width: 500px;
  margin: auto;
  background: #fff;
  padding: 20px;
  box-shadow: 0 0 10px rgba(0,0,0,0.2);
  border-radius: 10px;
}
input {
  padding: 10px;
  width: 70%;
  margin-bottom: 10px;
}
button {
  padding: 10px 20px;
  background: #007bff;
  color: #fff;
  border: none;
  border-radius: 5px;
}
</style>
</head>
<body>
<div class="card">
  <h2>Download Your Marksheet</h2>
  <input type="text" id="roll" placeholder="Enter Roll Number">
  <br>
  <button onclick="getMarksheet()">Get Marksheet</button>
  <div id="result" style="margin-top:20px;"></div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script>
const { jsPDF } = window.jspdf;

async function getMarksheet() {
  const roll = document.getElementById('roll').value;
  const response = await fetch(`https://script.google.com/macros/s/AKfycbyl0kGeuBqG8Os7IypplKRIBkX07Ge4SDIlhYp-NyfJfbAfgbf3REk8krm9iwwm36-R/exec?roll=${roll}`);
  const data = await response.json();
  
  if (data.error) {
    document.getElementById('result').innerHTML = "<p style='color:red;'>Roll Number not found</p>";
  } else {
    document.getElementById('result').innerHTML = `
      <h3>${data.name}</h3>
      <p>Total: ${data.total} | Grade: ${data.grade}</p>
      <button onclick='generatePDF(${JSON.stringify(data)})'>Download PDF</button>
    `;
  }
}

function generatePDF(data) {
  const doc = new jsPDF();

  doc.setFontSize(16);
  doc.text("School Name", 80, 15);
  doc.setFontSize(12);
  doc.text("Student Marksheet", 85, 25);
  
  doc.text(`Roll No: ${data.roll}`, 20, 40);
  doc.text(`Name: ${data.name}`, 20, 50);
  
  doc.text("Subjects:", 20, 70);
  doc.text(`English: ${data.english}`, 20, 80);
  doc.text(`Math: ${data.math}`, 20, 90);
  doc.text(`Science: ${data.science}`, 20, 100);
  
  doc.text(`Total: ${data.total}`, 20, 120);
  doc.text(`Grade: ${data.grade}`, 20, 130);
  
  doc.save(`Marksheet_${data.roll}.pdf`);
}
</script>
</body>
</html>
